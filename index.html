<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Symulator Odległości</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      max-width: 100%;
    }

    .column {
      border: 2px solid #ccc;
      padding: 10px;
      border-radius: 8px;
      background-color: #f9f9f9;
    }

    .column.a {
      width: 900px;
      height: 900px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .column.b {
      flex: 1;
      max-width: 900px;
      min-width: 300px;
    }

    .column img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 5px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      font-size: 1rem;
      font-weight: bold;
    }

    .form-group select, .form-group input {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .form-group button {
      margin-top: 10px;
      padding: 10px;
      font-size: 1rem;
      font-weight: bold;
      color: white;
      background-color: #007bff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .form-group button:hover {
      background-color: #0056b3;
    }

    .message {
      margin-top: 10px;
      font-size: 1.2rem;
      font-weight: bold;
      color: #333;
    }

    @media screen and (max-width: 900px) {
      .container {
        flex-direction: column;
      }

      .column.a {
        width: 100%;
        height: auto;
      }

      .column.b {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>Symulator Odległości</h1>
  <div class="container">
    <!-- Kolumna A: Wyświetlanie obrazu -->
    <div class="column a" id="image-column">
      <img id="image-display" src="img/logo.jpg" alt="Logo">
    </div>

    <!-- Kolumna B: Wybór poziomu trudności i wprowadzanie odległości -->
    <div class="column b">
      <div class="form-group">
        <label for="difficulty-select">Wybierz poziom trudności:</label>
        <select id="difficulty-select">
          <option value="" disabled selected>Wybierz...</option>
          <option value="basic">Podstawowy</option>
          <option value="medium">Średni</option>
          <option value="advanced">Zaawansowany</option>
        </select>
      </div>
      <div class="form-group">
        <label for="distance-input">Podaj odległość:</label>
        <input type="number" id="distance-input" placeholder="Wpisz odległość w metrach">
        <button id="submit-distance">Zatwierdź</button>
      </div>
      <div class="message" id="result-message">Podaj odległość...</div>
    </div>
  </div>

  <script>
    const imageDisplay = document.getElementById('image-display');
    const difficultySelect = document.getElementById('difficulty-select');
    const distanceInput = document.getElementById('distance-input');
    const resultMessage = document.getElementById('result-message');
    const submitDistanceButton = document.getElementById('submit-distance');

    const imageFolders = {
      basic: "img/basic/",
      medium: "img/medium/",
      advanced: "img/advanced/"
    };

    let currentImage = "logo.jpg";
    let correctDistance = 0;

    // Funkcja pobierająca listę obrazków z serwera
    async function fetchImageList(folder) {
      try {
        const response = await fetch(`/images/${folder}`);
        if (!response.ok) throw new Error('Błąd w pobieraniu obrazków');
        return await response.json();
      } catch (error) {
        console.error('Błąd:', error);
        return [];
      }
    }

    // Funkcja losująca obrazek z danego poziomu
    async function getRandomImage(level) {
      const images = await fetchImageList(level);
      if (images.length === 0) {
        console.error('Brak obrazków w folderze:', level);
        return "logo.jpg"; // Domyślny obrazek w przypadku braku plików
      }
      const randomIndex = Math.floor(Math.random() * images.length);
      return images[randomIndex];
    }

    // Zmiana obrazka po wyborze poziomu trudności
    difficultySelect.addEventListener('change', async () => {
      const selectedLevel = difficultySelect.value;
      if (selectedLevel) {
        const randomImage = await getRandomImage(selectedLevel);
        currentImage = randomImage;
        const [_, distance] = randomImage.split('_'); // Pobierz odległość z nazwy pliku
        correctDistance = parseInt(distance.split('.')[0], 10);
        imageDisplay.src = imageFolders[selectedLevel] + randomImage;
        imageDisplay.alt = randomImage.split('_')[0];
        resultMessage.textContent = `Podaj odległość do ${imageDisplay.alt}...`;
      }
    });

    // Obsługa zatwierdzania wpisanej odległości
    submitDistanceButton.addEventListener('click', () => {
      const userDistance = parseInt(distanceInput.value, 10);
      if (!isNaN(userDistance)) {
        const result = userDistance === correctDistance
          ? "Gratulacje! Trafiłeś."
          : `Niepoprawne. Prawidłowa odległość to ${correctDistance} metrów.`;
        resultMessage.textContent = result;
        distanceInput.value = "";
      } else {
        resultMessage.textContent = "Wpisz prawidłową odległość.";
      }
    });

    // Reset do domyślnego obrazka po odświeżeniu strony
    window.addEventListener('load', () => {
      imageDisplay.src = "img/logo.jpg";
      imageDisplay.alt = "Logo";
      resultMessage.textContent = "Podaj odległość...";
    });
  </script>
</body>
</html>
